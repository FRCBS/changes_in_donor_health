---
title: "Explorative data analysis for FINDONOR- CHANGES IN SELF-RATED HEALTH DURING THE STUDY AND IT'S RELATION TO IRON BIOMARKERS "
author: "Mikko Arvasr"
date: "`r Sys.time()`"
output: html_document
---

TARKISTA, ETTÃ„ KAIKKI JOTKA ON KUSSAKIN MALLISSA ON YRITETTY BOOTISSA


```{r setup, include=FALSE}
Sys.setlocale("LC_MESSAGES", 'en_GB.UTF-8')
Sys.setenv(LANG = "en_US.UTF-8")
# echo "rmarkdown::render('explorative_analysis.Rmd', clean=TRUE,output_format='html_document',output_file='../results/explorative_analysis.html')" | R --slave
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE
)
library(epiDisplay)
library(tidyverse)
library(safeBinaryRegression)
#library(epitools)
#library(ez)
library(lubridate)
#library(ggbeeswarm)
library(tidymodels)
#library(broom)
#library(GGally)
#library(ggfortify)
library(car)
library(boot)

#https://stats.stackexchange.com/questions/11109/how-to-deal-with-perfect-separation-in-logistic-regression
#https://stats.stackexchange.com/questions/45803/logistic-regression-in-r-resulted-in-perfect-separation-hauck-donner-phenomenon
```


# Executive summary

This file includes the code for computing the regression results regarding the predictors of the evolution of self-related health during the FinDonor study for the 
# Load the data

We load the data from hypothesis based regressions and initial data analysis and combine them together. 

```{r loading}
#Load questionnaire data recoded to change
load(file = "../results/changedata.rdata") 


#Load data used in hypothesis regressions
load(file = "../results/hypregdata.rdata")


#We cannot know if our "Reduced","Stable","Increased" factor levels are equally spaced. Hence make the variables unordered.
#changedata %>% mutate_at(funs(ordered), l1) %>% mutate_each_(funs(as.numeric), l2)
changedata <- changedata %>% mutate_if(is.ordered, function(x){factor(x,ordered = FALSE)})
regression_data_men <- inner_join(changedata,reg_data$men,by=c("donor"="donor"))
regression_data_post_menop_women <- inner_join(changedata,reg_data$womenpost,by=c("donor"="donor"))
regression_data_pre_menop_women <- inner_join(changedata,reg_data$womenpre,by=c("donor"="donor"))

#Bringing in extra data will bring some NAs
regression_data_men <- droplevels(na.omit(regression_data_men))
regression_data_post_menop_women <- droplevels(na.omit(regression_data_post_menop_women)) 
regression_data_pre_menop_women <- droplevels(na.omit(regression_data_pre_menop_women))

#Sleep night needs to be scaled
regression_data_men <- regression_data_men %>% mutate(sleep_night_d = scale(sleep_night_d, scale = FALSE)[,1]) 
regression_data_post_menop_women <- regression_data_post_menop_women %>% mutate(sleep_night_d = scale(sleep_night_d, scale = FALSE)[,1])
regression_data_pre_menop_women <- regression_data_pre_menop_women %>% mutate(sleep_night_d = scale(sleep_night_d, scale = FALSE)[,1])


#Fuse back together for later use "Pre_menopause_women", "Post_menopause_women","Men" and join with unscaled data
m<- regression_data_men %>% mutate(group = "Men")
e<- regression_data_post_menop_women %>% mutate(group = "Post_menopause_women")
o <- regression_data_pre_menop_women %>% mutate(group = "Pre_menopause_women")
temp <- bind_rows(m,e,o) %>%  select(-age,-BMI_diff,-donation_frequency,-Hb_beginning,-log_Ferritin_beginning,-starting_weight)
file <- "../results/hypregdata_unscaled.rdata"
load(file=file)
regression_data <- regression_data %>% select(age,BMI_diff,donation_frequency,Hb_beginning,log_Ferritin_beginning,starting_weight,donor) %>% inner_join(temp,by=c("donor"="donor")) #%>% select(-anemia_hist_d,-high_hb_hist_d,-education,-smoking_behavior)

```


# Premenopausal women

Check that final data has some variation
```{r}
summary(regression_data_pre_menop_women)
```

There is only one case who aquired high Hb during the research period. With "education" and "smoking" included as explenatory variables the glm function could not find a fit for post_menopause women. Futhermore for men anemia_history caused "perfect separation" found with function "safeBinaryRegression".  
For sake of completnes  all these variables are removed from all the models. None of these variables showed any level of significance in the groups of donors were they could be modelled hence excluding is not likely to miss any true effects.

```{r}
logit_pre_menop_women <- glm(health_outcome ~ age + starting_weight + BMI_diff + 
                               log_Ferritin_beginning + Hb_beginning +
                              donation_frequency + health_very_good + health_excellent +
                              cholesterol_d + 
                              blood_sugar_d + 
                               HBP_d + 
                                low_hb_hist_d + 
                               anemia_hist_d + 
#                               high_hb_hist_d + # The following terms are causing separation among the sample points: high_hb_hist_dTRUE
                               iron_supp_d + 
                               sleep_night_d + 
                               freq_calm_d + 
                               freq_red_meat_d + 
                               freq_fruits_d + 
                               freq_juices_d + 
                               freq_wholem_d + 
                               freq_milk_d + 
                               freq_cof_d + 
                               freq_tea_d + 
                               phys_cond_d + 
                               act_heavy_d + 
                               sleep_enough_d + 
                               day_act_d + 
                               h_act_light_d + 
                               vita_multi_d + 
                               vita_iron_d + 
                               sleep_tired_d + 
                               anti_inf_d + 
                               phys_inf_d + 
                               ment_inf_d + 
                               freq_alc_d +
                               life_qual +
                               education  +  
                               employment + 
                             smoking_behavior  
                             ,
                             data=regression_data_pre_menop_women,
                            family="binomial", separation = 'test')
 
 summary(logit_pre_menop_women)
```

cholesterol_d + blood_sugar_d + HBP_d + low_hb_hist_d + anemia_hist_d + high_hb_hist_d + iron_supp_d + sleep_night_d + freq_calm_d + freq_red_meat_d + freq_fruits_d + freq_juices_d + freq_wholem_d + freq_milk_d + freq_cof_d + freq_tea_d + phys_cond_d + act_heavy_d + sleep_enough_d + day_act_d + h_act_light_d + vita_multi_d + vita_iron_d + sleep_tired_d + anti_inf_d + phys_inf_d + ment_inf_d + freq_alc_d 

```{r}
plot(logit_pre_menop_women)
```

```{r}
vif(logit_pre_menop_women)
```

```{r}
logistic.display(logit_pre_menop_women)
```


```{r}
tidy_logit_pre_menop_women <-
  logit_pre_menop_women %>% 
  tidy %>% 
  mutate(OR = exp(estimate),
         group = "Pre_menopause_women") %>% mutate(p.value = p.value * 2)
#p-values are multiplied by 2 as we will make also second analysis for improved health with the same data set.
```


# Post menopausal women

```{r}
summary(regression_data_post_menop_women)
```

There are no cases who aquired high Hb during the research period. high_hb_hist_d should be removed.

```{r}
logit_post_menop_women <- glm(health_outcome ~ age + starting_weight + BMI_diff + 
                               log_Ferritin_beginning + Hb_beginning +
                              donation_frequency + health_very_good + health_excellent +
                               cholesterol_d + 
                              # blood_sugar_d + # Separation exists among the sample points.
                               HBP_d + 
                               low_hb_hist_d + 
                              anemia_hist_d + 
                               high_hb_hist_d + 
                               iron_supp_d + 
                               sleep_night_d + 
                               freq_calm_d + 
                               freq_red_meat_d + 
                               freq_fruits_d + 
                               freq_juices_d + 
                               freq_wholem_d + 
                               freq_milk_d + 
                               freq_cof_d + 
                               freq_tea_d + 
                               phys_cond_d + 
                               act_heavy_d + 
                               sleep_enough_d + 
                               day_act_d + 
                               h_act_light_d + 
                               vita_multi_d + 
                               #vita_iron_d + #eparation exists among the sample points.
                               sleep_tired_d + 
                               anti_inf_d + 
                               phys_inf_d + 
                               ment_inf_d + 
                               freq_alc_d +
                               life_qual +
                               education + 
                               employment +
                               smoking_behavior
                             ,
                             data=regression_data_post_menop_women,
                            family="binomial", separation = 'test')
 
 summary(logit_post_menop_women)
```

cholesterol_d + blood_sugar_d + HBP_d + low_hb_hist_d + anemia_hist_d + high_hb_hist_d + iron_supp_d + sleep_night_d + freq_calm_d + freq_red_meat_d + freq_fruits_d + freq_juices_d + freq_wholem_d + freq_milk_d + freq_cof_d + freq_tea_d + phys_cond_d + act_heavy_d + sleep_enough_d + day_act_d + h_act_light_d + vita_multi_d + vita_iron_d + sleep_tired_d + anti_inf_d + phys_inf_d + ment_inf_d + freq_alc_d 

```{r}
plot(logit_post_menop_women)
```

```{r}
vif(logit_post_menop_women)
```
High VIF values indicate that for post menopausal women the analysis is not reliable as there is much colinearity.

```{r}
logistic.display(logit_post_menop_women)
```

```{r}
tidy_logit_post_menop_women <-
  logit_post_menop_women %>% 
  tidy %>% 
  mutate(OR = exp(estimate),
         group = "Post_menopause_women") %>% mutate(p.value = p.value * 2)
#p-values are multiplied by 2 as we will make also second analysis for improved health with the same data set.
```



# Post menopausal women

```{r}
summary(regression_data_men)
```

There are 2 cases who aquired high Hb during the research period and it was not used in models with women. high_hb_hist_d should be removed.

```{r}
logit_men <- glm(health_outcome ~ age + starting_weight + BMI_diff + 
                               log_Ferritin_beginning + Hb_beginning +
                              donation_frequency + health_very_good + health_excellent +
                             cholesterol_d + 
                               blood_sugar_d + 
                               HBP_d + 
                               low_hb_hist_d + 
                              # anemia_hist_d + # eparation exists among the sample points.
                               high_hb_hist_d + 
                               iron_supp_d + 
                               sleep_night_d + 
                               freq_calm_d + 
                               freq_red_meat_d + 
                               freq_fruits_d + 
                               freq_juices_d + 
                               freq_wholem_d + 
                               freq_milk_d + 
                               freq_cof_d + 
                               freq_tea_d + 
                               phys_cond_d + 
                               act_heavy_d + 
                               sleep_enough_d + 
                               day_act_d + 
                               h_act_light_d + 
                               vita_multi_d + 
                               vita_iron_d + 
                               sleep_tired_d + 
                               anti_inf_d + 
                               phys_inf_d + 
                               ment_inf_d + 
                               freq_alc_d +
                               life_qual +
                               education + 
                               employment +
                              smoking_behavior
                             ,
                             data=regression_data_men,
                          #    data=test_data_std,
                            family="binomial", separation = 'test')
 
 summary(logit_men)
 
 
```

cholesterol_d + blood_sugar_d + HBP_d + low_hb_hist_d + anemia_hist_d + high_hb_hist_d + iron_supp_d + sleep_night_d + freq_calm_d + freq_red_meat_d + freq_fruits_d + freq_juices_d + freq_wholem_d + freq_milk_d + freq_cof_d + freq_tea_d + phys_cond_d + act_heavy_d + sleep_enough_d + day_act_d + h_act_light_d + vita_multi_d + vita_iron_d + sleep_tired_d + anti_inf_d + phys_inf_d + ment_inf_d + freq_alc_d 

```{r}
plot(logit_men)
```

```{r}
vif(logit_men)
```

```{r}
logistic.display(logit_men)
```


```{r}
tidy_logit_men <-
  logit_men %>% 
  tidy %>% 
  mutate(OR = exp(estimate),
         group = "Men") %>% mutate(p.value = p.value * 2)
#p-values are multiplied by 2 as we will make also second analysis for improved health with the same data set.
```


# Bootstraps

```{r}
detach("package:safeBinaryRegression", unload=TRUE)
#safeBinaryRegression messes up booting
```

## Define auxiliarry functions for bootstrapping
```{r}

# https://www.painblogr.org/2017-10-18-purrring-through-bootstraps.html


get_coefficients <- function(data, boot_ind){
  fit <- glm (health_outcome~.,
              data[boot_ind,],
              family = "binomial")
#  print(names(coef(fit)))
  return(coef(fit))
}



compute_Bca_CI <-function(fit_boot){
  Bca_inf = rep(0, length(fit_boot$t0))
  Bca_sup = rep(0, length(fit_boot$t0))
  for (i_regressor in 1:length(fit_boot$t0)){
    CI <- boot.ci(fit_boot, type = "bca", index=i_regressor)
    Bca_inf[i_regressor] <- CI$bca[4]
    Bca_sup[i_regressor] <- CI$bca[5]
  }
  return(tibble(Bca_inf,Bca_sup, regressor = names(fit_boot$t0)) %>% 
           filter(regressor != "(Intercept)"))
}


get_bootstrap <- function(data, nb_boot){
 cat(nrow(data),"get_bootstrap 1\n")
 

    fit_boot <- boot(data, statistic= get_coefficients, R = nb_boot)

 cat(nrow(data),"get_bootstrap 2\n")
  fit_boot_distrib <- as.tibble(fit_boot$t)  
  names(fit_boot_distrib) <- names(fit_boot$t0)

  fit_boot_Bca <- compute_Bca_CI(fit_boot)
  cat(nrow(data),"get_bootstrap 3\n")
  return(list(fit_boot_distrib,fit_boot_Bca))
}


```

## Run bootstrapping
```{r}
# Error in t.star[r, ] <- res[[r]] : 
#   number of items to replace is not a multiple of replacement length
#can sometimes be fixed by just adding bootstrap, but sometimes requires dropping out a variable


get_bootstrap_coeffs <- function(regression_data, current_group, nb_boot )
{

  ## preprocess and standardize data
  
    test_data_std <- regression_data %>% 
      filter(group == current_group) %>% 
      dplyr::select(donor, age, starting_weight, BMI_diff,
                    log_Ferritin_beginning, Hb_beginning, 
                    donation_frequency) %>% 
      gather(key = key, value = value, -donor) %>% 
      group_by(key) %>% 
      mutate(value_scale = scale(value, scale = FALSE)[,1]) %>% 
      dplyr::select(-value) %>% 
      spread(key = key, value = value_scale) 
     
    if (current_group == "Men") {
      test_data_std <- inner_join(test_data_std,regression_data %>% 
                                    dplyr::select(donor, health_outcome, health_very_good, health_excellent,
                                                  cholesterol_d,
                                                  blood_sugar_d,
                                                  HBP_d,
                                                  low_hb_hist_d,
                                                  iron_supp_d,
                                                  freq_calm_d,
                                                  freq_red_meat_d,
                                                  freq_fruits_d,
                                                  freq_juices_d,
                                                  freq_wholem_d,
                                                  freq_milk_d,
                                                  freq_cof_d,
                                                  freq_tea_d,
                                                  phys_cond_d,
                                                  act_heavy_d,
                                                  sleep_enough_d,
                                                  day_act_d,
                                                  h_act_light_d,
                                                  vita_multi_d,
                                                  vita_iron_d,
                                                  sleep_tired_d,
                                                  anti_inf_d,
                                                  phys_inf_d,
                                                  ment_inf_d,
                                                  freq_alc_d,
                                                  life_qual,
                                                  employment
                                                  
                                    ),
                                  by = "donor") %>% 
        dplyr::select(-donor) 
    }
    
    if (current_group == "Pre_menopause_women") {
      test_data_std <- inner_join(test_data_std,regression_data %>% 
                                    dplyr::select(donor, health_outcome, health_very_good, health_excellent,
                                                  cholesterol_d,
                                                  blood_sugar_d,
                                                  HBP_d,
                                                  low_hb_hist_d,
                                                  iron_supp_d,
                                                  freq_calm_d,
                                                  freq_red_meat_d,
                                                  freq_fruits_d,
                                                  freq_juices_d,
                                                  freq_wholem_d,
                                                  freq_milk_d,
                                                  freq_cof_d,
                                                  freq_tea_d,
                                                  phys_cond_d,
                                                  act_heavy_d,
                                                  sleep_enough_d,
                                                  day_act_d,
                                                  h_act_light_d,
                                                  vita_multi_d,
                                                  #vita_iron_d, #Error in t.star[r, ] <- res[[r]]
                                                  sleep_tired_d,
                                                  anti_inf_d,
                                                  phys_inf_d,
                                                  ment_inf_d,
                                                  freq_alc_d,
                                                  life_qual,
                                                  employment
                                                  
                                    ),
                                  by = "donor") %>% 
        dplyr::select(-donor) 
    }
    
      if (current_group == "Post_menopause_women") {
      test_data_std <- inner_join(test_data_std,regression_data %>% 
                                    dplyr::select(donor, health_outcome, health_very_good, health_excellent,
                                                 cholesterol_d,
                                                 blood_sugar_d,
                                                  HBP_d,
                                                  low_hb_hist_d,
                                                  iron_supp_d,
                                                  freq_calm_d,
                                                  freq_red_meat_d,
                                                  freq_fruits_d,
                                                  freq_juices_d,
                                                  freq_wholem_d,
                                                  freq_milk_d,
                                                  freq_cof_d,
                                                  freq_tea_d,
                                                  phys_cond_d,
                                                  act_heavy_d,
                                                  sleep_enough_d,
                                                  day_act_d,
                                                  h_act_light_d,
                                                  vita_multi_d,
                                                  #vita_iron_d #Error in t.star[r, ] <- res[[r]]
                                                  sleep_tired_d,
                                                  anti_inf_d,
                                                  phys_inf_d,
                                                  # ment_inf_d # Error in t.star[r, ] <- res[[r]]
                                                  freq_alc_d,
                                                  life_qual, # Error in bca.ci(boot.out, conf, index[1L], L = L, t = t.o, t0 = t0.o,  : estimated adjustment 'w' is infinite -> works if 10k boots.
                                                  employment
                                                  
                                    ),
                                  by = "donor") %>% 
        dplyr::select(-donor) 
    }
  cat(nrow(test_data_std),current_group,"get_bootstrap_coeffs 1\n")
  result <- test_data_std %>% 
  get_bootstrap(nb_boot = nb_boot)

  cat(nrow(test_data_std),current_group,"get_bootstrap_coeffs 2\n")
  bootstrap_distrib <- result[[1]] %>% 
    gather(key = regressor, value = coefficient) %>% 
    filter(regressor != "(Intercept)") %>% 
    mutate(group = current_group)
      cat(nrow(test_data_std),current_group,"get_bootstrap_coeffs 3\n")
  Bca_CI  <- result[[2]] %>% mutate(group = current_group)
  cat(nrow(test_data_std),current_group,"get_bootstrap_coeffs 4\n")
  return(list(bootstrap_distrib,Bca_CI))
}




#get_from_file_ferr = TRUE



set.seed(125)
#group_str = "Pre_menopause_women"

for(group_str in c("Pre_menopause_women", "Post_menopause_women","Men")){
#  for(group_str in c("Pre_menopause_women","Men")) {
#for(group_str in c("Post_menopause_women","Pre_menopause_women")){
  output_file_distrib = paste0("../results/bootstraps/exp_coeff_boot_distrib_seed_125_ctr_strata_final_",group_str,".rdata")
  output_file_Bca = paste0("../results/bootstraps/exp_coeff_boot_Bca_seed_125_ctr_strata_final_",group_str,".rdata")
  get_from_file_ferr <- all(file.exists(output_file_distrib),file.exists(output_file_Bca) )
  if (get_from_file_ferr){
    cat("Loading boots from file for group ",group_str,"\n")
    stuff <- list()
    load(file=output_file_distrib)
    load(file=output_file_Bca)
    stuff[[1]] <- temp1  
    stuff[[2]] <- temp2
    
  }else {
    stuff <- get_bootstrap_coeffs(regression_data, group_str, nb_boot = 1000)
    #         stuff <- get_bootstrap_coeffs(regression_data, group_str, nb_boot = 1000)
    temp1 <- stuff[[1]] 
    temp2 <- stuff[[2]] 
    save(temp1,file=output_file_distrib) 
    save(temp2,file=output_file_Bca)
  }
  
  if(!exists("bootstrap_distrib")){
    cat("initializing bootstrap_distrib & bootstrap_Bca_CI\n")

    bootstrap_distrib <- stuff[[1]]
    bootstrap_Bca_CI <- stuff[[2]]
  }else
  {
    cat("bootstrap_distrib & bootstrap_Bca_CI already exist\n")
    bootstrap_distrib<-bind_rows(bootstrap_distrib, stuff[[1]])
    bootstrap_Bca_CI<-bind_rows(bootstrap_Bca_CI, stuff[[2]])
  }
  
}


```

```{r}
bootstrap_Bca_CI %>%  group_by(group) %>% count()

```

# Forest plots

```{r}
# "\U0394 BMI"

regressor_values <- c(
 "age" = "Age",
   "BMI_diff" = "BMI difference",
   "donation_frequency" = "Donation frequency",
   "Hb_beginning" = "Initial Hemoglobin",
   "log_Ferritin_beginning" ="Initial Ferritin",
   "starting_weight" ="Initial weight",
   "health_very_good" ="Initial health rating \n Very good vs Satisfactory/Good",
    "health_excellent" = "Initial health rating \n Excellent vs Satisfactory/Good"
)
```

```{r}
bootstrap_Bca_CI <-
  tidy_logit_men %>% 
  bind_rows(tidy_logit_post_menop_women) %>% 
  bind_rows(tidy_logit_pre_menop_women) %>% 
  dplyr::select(group, term, OR, p.value) %>% 
  rename(regressor = term) %>% 
  full_join(bootstrap_Bca_CI,
            by =  c("regressor", "group")) %>% 
  filter(regressor != "(Intercept)") %>% 
  mutate(Bca_inf = exp(Bca_inf),
         Bca_sup = exp(Bca_sup),
         is_sig = p.value < 0.05)
# %>% 
#   mutate(regressor = plyr::revalue(regressor, regressor_values),
#     regressor = ordered(regressor,
#                     levels =  c("Age", "Initial weight", "BMI difference",  "Initial Hemoglobin", 
#                                 "Initial Ferritin","Donation frequency",
#                                "Initial health rating \n Very good vs Satisfactory/Good",
#                                "Initial health rating \n Excellent vs Satisfactory/Good")),
#     regressor = fct_rev(regressor),
#     group = case_when(group == "Pre_menopause_women" ~ "Pre-menopausal women",
#       group == "Post_menopause_women" ~ "Post-menopausal women",
#       TRUE ~ "Men"),
#     group = ordered(group, levels = c(  "Pre-menopausal women",  "Post-menopausal women", "Men"  ) ))


```

```{r}

# "\U0394 BMI"
bootstrap_distrib %>% 
  mutate(regressor = plyr::revalue(regressor, regressor_values),
  regressor = ordered(regressor,
                  levels =  c("Age", "Initial weight", "BMI difference",  "Initial Hemoglobin", 
                              "Initial Ferritin","Donation frequency",
                              "Initial health rating \n Very good vs Satisfactory/Good",
                              "Initial health rating \n Excellent vs Satisfactory/Good")),
  regressor = fct_rev(regressor),
  group = case_when(group == "Pre_menopause_women" ~ "Pre-menopausal women",
    group == "Post_menopause_women" ~ "Post-menopausal women",
    TRUE ~ "Men"),
  group = ordered(group, levels = c( "Men",  "Post-menopausal women", "Pre-menopausal women" ) )) %>% 
  mutate(OR = exp(coefficient)) %>% 
  ggplot(aes(x = regressor, y = OR, color = group, fill = group)) +
  geom_hline(yintercept = 1 , color = "grey", linetype = "dotted",
             size = 1) +
  # geom_violin(alpha = 0.15, trim = TRUE, position = position_dodge(width = 0.8), size = 0.1) +
  geom_pointrange(data = bootstrap_Bca_CI, 
                  aes(ymin=Bca_inf, ymax = Bca_sup, shape = is_sig, color = group, fill = group),
                  position = position_dodge(width = 0.7), size = 1) +
  # geom_point(data = bootstrap_Bca_CI, 
  #            aes(shape = is_sig, fill = group),
  #            position = position_dodge(width = 0.8), size = 2) +
    scale_color_manual(values = c(  "#0065BD", "#BA0303", "#C50084" ),
                     limits = c("Men",  "Post-menopausal women","Pre-menopausal women" )) +
     scale_fill_manual(values = c(  "#0065BD", "#BA0303", "#C50084" ),
                     limits = c("Men",  "Post-menopausal women","Pre-menopausal women" )) +
 scale_shape_manual(values = c(1,16)) +
  scale_y_log10(limits=c(1/40,40)) +
  # scale_x_discrete(labels=parse(text=unique(bootstrap_Bca_CI$regressor)))
  # ylim(1/35, 35) +
  guides(shape = FALSE) +
  theme_classic() +
  # theme(legend.position = c(0.8,0.9),
  #       legend.title = element_blank(),
  #       legend.box = "vertical",
  #       legend.text = element_text(size = 20),
  #       plot.title =  element_text(size = 24,
  #                                 hjust = 0),
  #       panel.grid.minor.y = element_blank(),
  #       axis.line = element_line(colour="black"),
  #       axis.title.y = element_blank(),
  #       axis.title.x = element_text(size = 24),
  #       axis.text = element_text(size = 22),
  #       panel.grid.major.y = element_blank()) +
  coord_flip() +
  xlab("Robust standardized coefficient") +
  labs(title = "PREDICTORS OF WORSENED SELF-RATED HEALTH \nBETWEEN QUESTIONNAIRES",
       subtitle = "") +


   theme(axis.title = element_text(size = 14),
        strip.text =  element_text(size = 14),
        legend.text = element_text(size = 12),
        strip.background = element_rect(fill = "white"),
        strip.background.x = element_blank(),
        axis.text.y = element_text(size = 14),
        axis.text.x = element_text(size = 14, angle = 30,hjust = 0.8),
        plot.title =  element_text(size = 16),
        plot.subtitle = element_text(size = 16,
                                     hjust = 0.5))
   #
ggplot2::ggsave(filename = "../results/figures/log_reg_results_b.png",
       width = 35,
       height = 18,
       dpi = "print",
       units = "cm")

```








